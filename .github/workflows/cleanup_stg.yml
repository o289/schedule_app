name: Cleanup STG Environment (Scheduled)

on:
    schedule:
        # æ¯Žæ—¥ æ·±å¤œ 3:30 JSTï¼ˆ= 18:30 UTCï¼‰
        - cron: "30 18 * * *"
    workflow_dispatch:

jobs:
    cleanup-stg:
        runs-on: ubuntu-latest

        steps:
            - name: Cleanup STG containers and volumes
              uses: appleboy/ssh-action@v1.0.0
              with:
                  host: ${{ secrets.VPS_HOST }}
                  username: ${{ secrets.VPS_USER }}
                  key: ${{ secrets.VPS_SSH_KEY }}
                  script: |
                      echo "ðŸ§¹ Cleaning up STG environment..."
                      cd /home/${{ secrets.VPS_USER }}/schedule_app

                      docker compose -f infra/docker/docker-compose.stg.yml down -v || true

                      echo "âœ… STG environment fully removed"
